---
import Layout from "../../layouts/Layout.astro";
import { getEntry } from "astro:content";
// 1. Get the slug from the incoming server request
const { slug } = Astro.params;
if (slug === undefined) {
  throw new Error("Slug is required");
}
// 2. Query for the entry directly using the request slug
const entry = await getEntry("work", slug);
// 3. Redirect if the entry does not exist
if (entry === undefined) {
  return Astro.redirect("/404");
}
// 4. (Optional) Render the entry to HTML in the template
const { Content } = await entry.render();

const title = entry.data.title;
---

<Layout title={title} entry={entry}>
    <section class="max-w-[65ch] w-4/5 my-12">
        <h1 class="text-3xl font-bold mt-4">{entry.data.title}</h1>
        <span class="block w-full border-t border-dotted mt-4"></span>
        {
            entry.data.awards != null &&
            entry.data.awards != undefined &&
            entry.data.awards.length != 0 ? (
                <div class="mt-4 text-sm">
                    <span class="font-bold tracking-wide">Awarded:</span>{" "}
                    {entry.data.awards.map((award, index) => {
                        const builder = [];
                        builder.push(award);
                        if (index != entry.data.awards!.length - 1) {
                            builder.push(", ");
                        }
                        return builder.join("");
                    })}
                </div>
            ) : null
        }
        <img
            class="w-fit mt-4"
            crossorigin="anonymous"
            src={entry.data.image}
            alt={`${entry.data.title} project image`}
        />
        <div class="mt-4 prose prose-invert">
            <Content />
        </div>
    </section>
</Layout>
